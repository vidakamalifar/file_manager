package com.malwarebytes.filemanager.utils;

import android.app.AlertDialog;
import android.content.Context;
import android.os.Build;
import android.os.Bundle;
import android.view.Gravity;
import android.view.View;
import android.view.Window;
import android.view.WindowManager;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.RequiresApi;

import com.malwarebytes.filemanager.R;

import java.io.File;
import java.nio.file.Paths;

import butterknife.BindView;
import butterknife.ButterKnife;


public class FileDetailDialog extends AlertDialog {

    @BindView(R.id.tvFileSize)
    TextView tvFileSize;
    @BindView(R.id.tvCreated)
    TextView tvCreated;
    @BindView(R.id.tvModified)
    TextView tvModified;
    @BindView(R.id.imageFile)
    ImageView imageFile;

    private File file;
    private Context context;

    public FileDetailDialog(Context context, File file) {
        super(context);
        this.file = file;
    }

    @RequiresApi(api = Build.VERSION_CODES.O)
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        setContentView(R.layout.dialog_file_detail);

        ButterKnife.bind(this);

        initDialogViews();
        setData();
    }

    private void initDialogViews() {

        Window window = getWindow();
        WindowManager.LayoutParams wlp = getWindow().getAttributes();

        wlp.gravity = Gravity.BOTTOM;
        if (window != null) {
            window.setAttributes(wlp);
        }
    }

    @RequiresApi(api = Build.VERSION_CODES.O)
    private void setData() {
        tvCreated.setText(FileUtil.convertFileTimeToString(Paths.get(file.getAbsolutePath())));
        tvFileSize.setText(FileUtil.getSize(Long.parseLong(FileUtil.convertSize(file.getPath()))));
        tvModified.setText(FileUtil.convertDateToString(file.lastModified()));

        if (FileUtil.isFileHasImage(file)) {
            imageFile.setVisibility(View.VISIBLE);
            imageFile.setImageBitmap(FileUtil.getImage(file.getAbsolutePath()));
        } else
            imageFile.setVisibility(View.GONE);

    }
}



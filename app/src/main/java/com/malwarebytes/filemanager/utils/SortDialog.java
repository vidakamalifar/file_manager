package com.malwarebytes.filemanager.utils;

import android.app.AlertDialog;
import android.content.Context;
import android.os.Bundle;
import android.view.Gravity;
import android.view.View;
import android.view.Window;
import android.view.WindowManager;
import android.widget.Button;
import android.widget.RadioButton;

import com.malwarebytes.filemanager.MyApplication;
import com.malwarebytes.filemanager.R;

import butterknife.BindView;
import butterknife.ButterKnife;


public class SortDialog extends AlertDialog implements View.OnClickListener {

    public static final String ALPHABETICALLY = "Alphabetically ";
    public static final String CHRONOLOGICALLY = "Chronologically ";
    public static final String EXTENSION = "Extension ";

    @BindView(R.id.rbName)
    RadioButton rbName;
    @BindView(R.id.rbDate)
    RadioButton rbDate;
    @BindView(R.id.rbType)
    RadioButton rbType;

    @BindView(R.id.rbAscending)
    RadioButton rbAscending;
    @BindView(R.id.rbDescending)
    RadioButton rbDescending;

    @BindView(R.id.bCancel)
    Button bCancel;
    @BindView(R.id.bDone)
    Button bDone;

    private boolean isAscending = false;
    private String sortType;
    private MyApplication myApplication;


    private SortDialogListener sortDialogListener;

    public SortDialog(Context context, SortDialogListener sortDialogListener) {
        super(context);
        this.sortDialogListener = sortDialogListener;

        myApplication = (MyApplication) context.getApplicationContext();
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        setContentView(R.layout.dialog_sort);

        ButterKnife.bind(this);

        initDialogViews();
        setData();
        setListener();
    }

    private void initDialogViews() {

        Window window = getWindow();
        WindowManager.LayoutParams wlp = getWindow().getAttributes();

        wlp.gravity = Gravity.BOTTOM;
        window.setAttributes(wlp);
    }

    private void setData() {
        if (myApplication.getSortType() != null)
            sortType = myApplication.getSortType();
        else
            sortType = ALPHABETICALLY;

        if (myApplication.isAscending())
            rbAscending.setChecked(true);
        else
            rbDescending.setChecked(true);


        switch (sortType) {
            case ALPHABETICALLY:
                rbName.setChecked(true);
                break;
            case CHRONOLOGICALLY:
                rbDate.setChecked(true);
                break;
            case EXTENSION:
                rbType.setChecked(true);
                break;
        }
    }

    private void setListener() {
        rbName.setOnClickListener(this);
        rbDate.setOnClickListener(this);
        rbType.setOnClickListener(this);
        rbAscending.setOnClickListener(this);
        rbDescending.setOnClickListener(this);
        bCancel.setOnClickListener(this);
        bDone.setOnClickListener(this);
    }

    @Override
    public void onClick(View view) {
        switch (view.getId()) {
            case R.id.rbName:
                sortType = ALPHABETICALLY;
                break;

            case R.id.rbDate:
                sortType = CHRONOLOGICALLY;
                break;

            case R.id.rbType:
                sortType = EXTENSION;
                break;

            case R.id.rbAscending:
                isAscending = true;
                break;

            case R.id.rbDescending:
                isAscending = false;
                break;

            case R.id.bCancel:
                dismiss();
                break;

            case R.id.bDone:
                sortDialogListener.sortList(isAscending, sortType);

                myApplication.setAscending(isAscending);
                myApplication.setSortType(sortType);

                dismiss();

                break;
        }
    }

    public interface SortDialogListener {
        void sortList(boolean isAscending, String sortType);
    }
}


